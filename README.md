## Тестовое задание на должность "младший разработчик Java" в компанию SELSUP.
## Текст задания:

Необходимо реализовать на языке Java (можно использовать 11 версию) класс для
работы с API Честного знака. Класс должен быть thread-safe и поддерживать ограничение
на количество запросов к API. Ограничение указывается в конструкторе в виде количества
запросов в определенный интервал времени. Например:
```
public CrptApi(TimeUnit timeUnit, int requestLimit)
```
- timeUnit – указывает промежуток времени – секунда, минута и пр.
- requestLimit – положительное значение, которое определяет максимальное количество
запросов в этом промежутке времени.

При превышении лимита запрос должен блокироваться, чтобы не превысить
максимальное количество запросов к API и продолжить выполнение, когда ограничение
не превышено.

Реализовать нужно единственный метод – Создание документа для ввода в оборот
товара, произведенного в РФ. Документ и подпись должны передаваться в метод в виде
Java объекта и строки соответственно.
При реализации можно использовать библиотеки HTTP клиента, JSON сериализации.
Реализация должна быть максимально удобной для последующего расширения
функционала.
Решение должно быть оформлено в виде одного файла CrptApi.java. Все дополнительные
классы, которые используются должны быть внутренними.
 ## Результат выполнения задания:

Реализован класс CrptApi, конструктор которого принимает 2 параметра: timeUnit и requestLimit, которые устанавливают следующие ограничения при работе с данным классом в соответствии с требованиями:
- timeUnit – указывает промежуток времени – секунда, минута и пр.
- requestLimit – положительное значение, которое определяет максимальное количество
  запросов в этом промежутке времени.

Пример:
```
CrptApi crptApi = new CrptApi(TimeUnit.Seconds, 1);
```
В результате создания объекта с вышеуказанными параметрами дальнейшая работа с данным классом будет ограничена 1 запросом в секунду. 

Ограничение на количество запросов к API происходит с помощью класса TimedSemaphore, механизм действия которого полностью соответствует требованиям. Для выполнения запросов к API используется thread-safe версия http клиента - CloseableHttpClient.

В классе CrptApi был реализован метод для создания документа для ввода в оборот товара, произведенного в РФ со следующей сигнатурой:
```
createDocumentLPIntroduceGoods(Model.Request.CreateDocumentRequest createDocumentRequest)
```
, где в качестве аргумента передаётся объект класса CreateDocumentRequest, содержащий необходимые (в соответствии с документацией API честного знака) поля, в том числе подпись.

Т.к. для создания документа необходимо получить токен доступа, с помощью метода obtainToken(String signature) класса, имплементирующего интерфейс TokenService, происходит запрос токена следующим образом в соответствии с документацией API честного знака:
0) Если токен уже был получен ранее и время жизни токена не истекло, то запрос к аутентификационному серверу не выполняется, а возвращается сохранённое значение,
1) происходит запрос сообщения, которое необходимо подписать имеющейся подписью, по следующему url, указанному в документации к API: https://ismp.crpt.ru/api/v3/auth/cert/key,
2) после получения сообщения оно подписывается* и отправляется запрос с этим сообщением в качестве одного из полей по следующему url: https://ismp.crpt.ru/api/v3/auth/cert. В случае успеха сервер в ответ на запрос возвращает токен, который будет сохранён на ближайшие 9 часов (по документации к API время жизни токена 10 часов, однако для подстраховки было указано меньшее время) и возвращён в качестве результата вызова метода.

*Т.к. не нашёл, каким образом подписывать сообщение, в качестве альтернативы возвращаю конкатенацию сообщения и подписи.

После получения токена доступа, отправляется запрос к url для создания документов: https://markirovka.crpt.ru/api/v3/lk/documents/create, где в качестве тела запроса указывается объект класса CreateDocumentRequest, сериализованный с помощью класса ObjectMapper в строку JSON. (при сериализации над полями объекта выполняются преобразования, необходимые в соответствии требованиями документации к API). 

В результате вызова метода createDocumentLPIntroduceGoods(...) будет возвращён объект класса ```Future<CreateDocumentResponse>```, содержащий либо уникальный идентификатор
документа в ИС МП, либо данные об ошибке в случае не успешного ответа.